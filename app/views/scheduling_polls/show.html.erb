<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
  <!-- Navigation -->
  <nav class="px-6 py-4 border-b border-gray-800">
    <div class="flex items-center justify-between max-w-6xl mx-auto">
      <div class="flex items-center space-x-4">
        <%= link_to root_path, class: "text-2xl font-bold text-white hover:text-cyan-400 transition-colors" do %>
          CommishTools
        <% end %>
        <span class="text-gray-400">|</span>
        <%= link_to dashboard_league_path(@league), class: "text-gray-400 hover:text-white transition-colors" do %>
          <%= @league.name %>
        <% end %>
        <span class="text-gray-400">|</span>
        <h1 class="text-xl font-semibold text-white"><%= @poll.title %></h1>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="px-6 py-8">
    <div class="max-w-6xl mx-auto">
      
      <!-- Poll Header -->
      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-6 mb-6">
        <div class="flex items-start justify-between">
          <div>
            <h2 class="text-2xl font-bold text-white mb-2"><%= @poll.title %></h2>
            <% if @poll.description.present? %>
              <p class="text-gray-400 mb-4"><%= @poll.description %></p>
            <% end %>
            <div class="flex items-center space-x-4 text-sm">
              <span class="inline-flex items-center px-3 py-1 rounded-full bg-cyan-500/20 text-cyan-400">
                <%= @poll.event_type.humanize %>
              </span>
              <span class="inline-flex items-center px-3 py-1 rounded-full <%= @poll.active? ? 'bg-green-500/20 text-green-400' : 'bg-gray-500/20 text-gray-400' %>">
                <%= @poll.status.humanize %>
              </span>
              <span class="text-gray-400">
                <%= @poll.response_count %> / <%= @league.members_count %> responses (<%= @poll.response_rate %>%)
              </span>
            </div>
          </div>
          
          <% if @poll.created_by == current_user || @league.owner == current_user %>
            <div class="flex space-x-2">
              <% if @poll.active? %>
                <%= button_to "Close Poll", 
                    close_league_scheduling_poll_path(@league, @poll),
                    method: :patch,
                    class: "px-4 py-2 text-sm bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors" %>
              <% else %>
                <%= button_to "Reopen Poll", 
                    reopen_league_scheduling_poll_path(@league, @poll),
                    method: :patch,
                    class: "px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" %>
              <% end %>
              <%= link_to "Edit", 
                  edit_league_scheduling_poll_path(@league, @poll),
                  class: "px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Shareable Link -->
      <div class="bg-gradient-to-r from-cyan-900/20 to-blue-900/20 rounded-xl border border-cyan-700/50 p-6 mb-6">
        <h3 class="text-lg font-semibold text-white mb-4">Share this poll with your league members</h3>
        <div class="flex items-center space-x-4">
          <input type="text" 
                 value="<%= public_scheduling_url(token: @poll.public_token) %>"
                 readonly
                 data-controller="clipboard"
                 data-clipboard-target="source"
                 class="flex-1 px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-300 font-mono text-sm">
          <button data-action="click->clipboard#copy"
                  data-clipboard-target="button"
                  class="px-6 py-2 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 transition-colors">
            Copy Link
          </button>
        </div>
        <p class="mt-2 text-sm text-gray-400">
          League members can use this link to submit their availability without needing to sign in.
        </p>
      </div>

      <!-- Time Slots & Availability -->
      <div class="bg-gray-800/50 rounded-xl border border-gray-700 p-6">
        <h3 class="text-xl font-bold text-white mb-6">Time Slot Options</h3>
        
        <div class="space-y-4">
          <% @poll.event_time_slots.each do |slot| %>
            <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
              <div class="flex items-center justify-between mb-2">
                <h4 class="text-lg font-semibold text-white">
                  <%= slot.display_label %>
                </h4>
                <% if @poll.response_count > 0 %>
                  <span class="text-sm text-gray-400">
                    Score: <%= slot.availability_score %>%
                  </span>
                <% end %>
              </div>
              
              <% if @poll.response_count > 0 %>
                <% summary = slot.availability_summary %>
                <div class="mt-3 flex items-center space-x-6">
                  <div class="flex items-center space-x-2">
                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                    <span class="text-sm text-gray-300">Available: <%= summary[:available] %></span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
                    <span class="text-sm text-gray-300">Maybe: <%= summary[:maybe] %></span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                    <span class="text-sm text-gray-300">Unavailable: <%= summary[:unavailable] %></span>
                  </div>
                </div>
                
                <!-- Progress bar visualization -->
                <div class="mt-3 h-6 bg-gray-600 rounded-full overflow-hidden flex">
                  <% if summary[:available] > 0 %>
                    <div class="bg-green-500 h-full" style="width: <%= (summary[:available].to_f / @poll.response_count * 100).round %>%"></div>
                  <% end %>
                  <% if summary[:maybe] > 0 %>
                    <div class="bg-yellow-500 h-full" style="width: <%= (summary[:maybe].to_f / @poll.response_count * 100).round %>%"></div>
                  <% end %>
                  <% if summary[:unavailable] > 0 %>
                    <div class="bg-red-500 h-full" style="width: <%= (summary[:unavailable].to_f / @poll.response_count * 100).round %>%"></div>
                  <% end %>
                </div>
              <% else %>
                <p class="text-gray-400 text-sm">No responses yet</p>
              <% end %>
            </div>
          <% end %>
        </div>

        <!-- Optimal Slots Recommendation -->
        <% if @poll.response_count > 0 %>
          <div class="mt-8 p-4 bg-cyan-900/20 rounded-lg border border-cyan-700/50">
            <h4 class="text-lg font-semibold text-cyan-400 mb-2">Recommended Time Slots</h4>
            <div class="space-y-2">
              <% @poll.optimal_slots(limit: 3).each_with_index do |slot, index| %>
                <div class="flex items-center space-x-3">
                  <span class="text-2xl"><%= ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"][index] %></span>
                  <span class="text-white"><%= slot.display_label %></span>
                  <span class="text-sm text-gray-400">(<%= slot.available_count %> available)</span>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Responses Details -->
      <% if @responses.any? %>
        <div class="mt-6 bg-gray-800/50 rounded-xl border border-gray-700 p-6">
          <h3 class="text-xl font-bold text-white mb-6">Response Details</h3>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left border-b border-gray-700">
                  <th class="pb-3 text-gray-300">Name</th>
                  <% @poll.event_time_slots.each do |slot| %>
                    <th class="pb-3 text-gray-300 text-center min-w-[100px]">
                      <%= slot.starts_at.strftime("%m/%d") %><br>
                      <span class="text-xs font-normal"><%= slot.starts_at.strftime("%l:%M %p") %></span>
                    </th>
                  <% end %>
                </tr>
              </thead>
              <tbody>
                <% @responses.each do |response| %>
                  <tr class="border-b border-gray-700/50">
                    <td class="py-3 text-white"><%= response.respondent_name %></td>
                    <% @poll.event_time_slots.each do |slot| %>
                      <td class="py-3 text-center">
                        <% if response.available_for?(slot) %>
                          <span class="inline-block w-6 h-6 bg-green-500 rounded-full"></span>
                        <% elsif response.maybe_for?(slot) %>
                          <span class="inline-block w-6 h-6 bg-yellow-500 rounded-full"></span>
                        <% else %>
                          <span class="inline-block w-6 h-6 bg-red-500 rounded-full"></span>
                        <% end %>
                      </td>
                    <% end %>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      <% end %>
      
    </div>
  </div>
</div>